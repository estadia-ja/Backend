generator client {
  provider = "prisma-client-js"
}

datasource estadia_db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String     @id @default(cuid())
  name       String
  email      String     @unique
  password   String
  userImage  Bytes?
  cpf        String     @unique
  phones     Phone[]
  properties Property[]
  reserves   Reserve[]
  favorites  FavoriteProperty[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  @@map("users")
}

model Phone {
  id     String @id @default(cuid())
  phone  String @unique
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("phones")
}

model Property {
  id               String          @id @default(cuid())
  type             String
  description      String
  maxGuests        Int      @default(1)
  numberOfBedroom  Int
  numberOfSuite    Int
  numberOfGarage   Int
  numberOfRoom     Int
  numberOfBathroom Int
  outdoorArea      Boolean
  pool             Boolean
  barbecue         Boolean
  street           String
  number           Int
  neighborhood     String
  state            String
  city             String
  CEP              String
  dailyRate        Float
  userId           String
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  images           PropertyImage[]
  reserves         Reserve[]
  favoritedBy      FavoriteProperty[]

  @@map("properties")
}

model PropertyImage {
  id         String   @id @default(cuid())
  image      Bytes
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("property_images")
}

model FavoriteProperty {
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  propertyId String
  property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@id([userId, propertyId])
  @@map("favorite_properties")
}

model Reserve {
  id                String             @id @default(cuid())
  dateStart         DateTime
  dateEnd           DateTime
  status            String
  propertyId        String
  property          Property           @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  userId            String
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  propertyValuation PropertyValuation?
  clientValuation   ClientValuation?
  payment           Payment?

  @@map("reserves")
}

model PropertyValuation {
  id                    String   @id @default(cuid())
  noteProperty          Float
  commentProperty       String?
  datePropertyValuation DateTime @default(now())
  reserveId             String   @unique
  reserve               Reserve  @relation(fields: [reserveId], references: [id], onDelete: Cascade)

  @@map("property_valuations")
}

model ClientValuation {
  id                  String   @id @default(cuid())
  noteClient          Float
  commentClient       String?
  dateClientValuation DateTime @default(now())
  reserveId           String   @unique
  reserve             Reserve  @relation(fields: [reserveId], references: [id], onDelete: Cascade)

  @@map("client_valuations")
}

model Payment {
  id           String   @id @default(cuid())
  paymentValue Float
  datePayment  DateTime
  reserveId    String   @unique
  reserve      Reserve  @relation(fields: [reserveId], references: [id], onDelete: Cascade)

  @@map("payments")
}
